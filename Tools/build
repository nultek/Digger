#!/bin/bash

cd "$(dirname "${BASH_SOURCE[0]}")"

npm install
typescript=./node_modules/typescript/lib

rm -f -r ../Build/Debug
rm -f -r ../Build/Release
mkdir -p ../Build/Debug
mkdir -p ../Build/Release

cp ../Source/index.html ../Build/Debug/index.html
cp ../Source/index.html ../Build/Release/index.html

echo $(tput bold)Building Debug/digger.js$(tput sgr0)

cat << EOF >> ../Build/Debug/data.ts
var spriteImageData = "$(base64 ../Source/Sprite.png)";
var spriteImageData = "$(base64 ../Source/Sprite.png)";
var fontImageData = "$(base64 ../Source/Font.png)";
var diamondSoundData = "$(base64 ../Source/Diamond.wav)";
var stoneSoundData = "$(base64 ../Source/Stone.wav)";
var stepSoundData = "$(base64 ../Source/Step.wav)";
EOF

node ${typescript}/tsc.js -target ES5 -out ../Build/Debug/digger.js ./libex.d.ts ../Source/*.ts ../Build/Debug/data.ts

rm ../Build/Debug/data.ts

echo $(tput bold)Building Release/digger.js$(tput sgr0)

node minify.js ../Build/Debug/digger.js ../Build/Release/digger.js
